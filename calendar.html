<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planificación Mensual de Pruebas de Enlaces</title>
    <!-- Carga de Tailwind CSS para un diseño profesional y responsive -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Configuración personalizada de Tailwind usando la paleta corporativa del usuario */
        :root {
            --color-primary: #144372; /* Azul Oscuro corporativo (20, 67, 114) */
            --color-secondary: #999999; /* Gris medio (153, 153, 153) para cabeceras y bases */
            --color-weekend: #E56A54; /* Color secundario (Rojo/Coral) para fines de semana */
            --color-background: #f9fafb; /* Fondo General (Gris muy claro) */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-background);
        }
        /* Contenedor principal del componente */
        .main-container {
            max-width: 100%; 
            font-size: 0.75rem; /* Base font size: text-xs (compact) */
        }
        .planning-grid-wrapper {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        .planning-table {
            border-collapse: separate; 
            border-spacing: 0;
            min-width: 100%;
        }
        .header-cell {
            min-width: 30px; 
            font-size: 0.75rem; 
            height: 30px; 
            padding: 0;
            line-height: 30px;
        }
        /* Sticky Column Styles */
        .sticky-region-col {
            position: sticky;
            left: 0;
            z-index: 20;
            min-width: 150px; /* Reducción para darle más espacio al cuerpo de la tabla */
            text-align: left;
            padding-left: 0.75rem; 
            padding-right: 0.5rem;
            font-weight: 500;
            background-color: inherit; 
            border-right: 1px solid #e5e7eb; 
            white-space: nowrap; 
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 0.75rem; 
            line-height: 1.25rem; 
        }
        /* Sticky Corners (Top-Left) */
        .sticky-corner-header {
            position: sticky;
            left: 0;
            top: 0;
            z-index: 30;
            background-color: var(--color-secondary);
            border-right: 1px solid #d1d5db;
        }
        .sticky-corner-days {
            position: sticky;
            left: 0;
            top: 30px; 
            z-index: 30;
            background-color: #d1d5db; /* Gris más claro que el secundario para contraste */
            border-right: 1px solid #d1d5db;
        }
        
        /* Fila del Título de Grupo (UNIDADES REGIONALES) */
        .group-header-row {
            /* Separación visual superior */
            border-top: 2px solid #999999;
        }

        /* Celda de Título de Grupo (columna izquierda) */
        .group-header-row .sticky-region-col {
            background-color: #d1d5db !important; /* Gris claro de Tailwind */
            font-weight: bold;
            text-transform: uppercase;
            z-index: 20;
            font-size: 0.875rem; /* text-sm for group titles */
            line-height: 1.1; 
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
            white-space: nowrap;
            vertical-align: middle;
        }
        
        /* Celda del Subtítulo Descriptivo (ocupa el espacio de los días) */
        .group-header-subtitle-cell {
            background-color: #e5e7eb; /* Gris ligeramente más claro que el título del grupo */
            font-weight: normal; /* Menos peso visual */
            font-size: 0.6rem; /* text-[0.6rem] */
            color: #1f2937; /* text-gray-900 */
            text-align: center; 
            padding-left: 0.75rem;
            padding-right: 0.75rem;
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
            white-space: nowrap;
            vertical-align: middle;
        }

        /* Estilo para el día de planificación (Bloque azul oscuro) */
        .marked-day {
            background-color: var(--color-primary);
            cursor: pointer;
            transition: background-color 0.1s ease;
        }
        .marked-day:hover {
            background-color: #0B2641; /* Azul muy oscuro del primer color de la paleta */
        }

        /* Días de la semana (Lunes a Viernes) */
        .weekday-bg {
            background-color: var(--color-primary); 
            color: white;
        }
        /* Fines de semana (Sábado y Domingo) */
        .weekend-bg {
            background-color: var(--color-weekend); 
            color: white;
        }

        /* Modal Styles - Mantener el tamaño para buena UX */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none; 
            justify-content: center;
            align-items: center;
            z-index: 50;
        }
        .modal-content {
            background: white;
            border-radius: 0.5rem;
            max-width: 90%;
            min-width: 350px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            animation: fadeIn 0.3s;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div class="main-container mx-auto bg-white shadow-xl rounded-xl border border-gray-200">
        <!-- Título y Navegación del Calendario -->
        <div id="calendar-header" class="p-4 border-b border-gray-200 flex flex-col sm:flex-row justify-between items-center bg-gray-50 rounded-t-xl no-print">
            <!-- Reducido el tamaño del título principal -->
            <h1 class="text-xl font-extrabold text-gray-800 mb-2 sm:mb-0">
                Planificación Mensual de Pruebas de Enlaces Satelitales <span class="text-blue-700 hidden sm:inline"></span>
            </h1>
            <div class="flex items-center space-x-4">
                <div id="month-navigation" class="flex items-center space-x-4">
                    <button onclick="changeMonth(-1)" class="p-1 rounded-full bg-blue-100 text-blue-800 hover:bg-blue-200 transition duration-150 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50" title="Mes Anterior">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                    </button>
                    <!-- Reducido el tamaño del mes/año -->
                    <h2 id="current-month-year" class="text-lg font-bold text-gray-700 min-w-[120px] text-center"></h2>
                    <button onclick="changeMonth(1)" class="p-1 rounded-full bg-blue-100 text-blue-800 hover:bg-blue-200 transition duration-150 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50" title="Mes Siguiente">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Contenedor principal de la matriz de planificación con scroll -->
        <div class="planning-grid-wrapper">
            <table class="planning-table w-full">
                <!-- Cuerpo de la tabla (Se llenará con JavaScript) -->
                <tbody id="planning-body">
                    <!-- Filas de cabecera de días y datos de planificación irán aquí -->
                </tbody>
            </table>
        </div>

        <!-- Leyenda / Observaciones -->
        <div id="calendar-footer" class="p-4 bg-gray-50 border-t border-gray-200 rounded-b-xl no-print">
            <h3 class="text-xs font-semibold text-gray-600 mb-1">Observaciones:</h3>
            <p class="text-[0.65rem] text-gray-500">
                La fecha marcada en azul oscuro indica un día de prueba de enlaces satelitales programado para la región o autoridad correspondiente.
            </p>
            <p class="text-[0.65rem] text-red-500 mt-1">
                *Servicio Nacional de Prevención y Respuesta ante Desastres (SENAPRED).
            </p>
        </div>
    </div>

    <!-- Modal para mostrar detalles del evento (Reemplaza a la notificación/alert) -->
    <div id="event-modal-overlay" class="modal-overlay" onclick="closeModal()">
        <div id="event-modal-content" class="modal-content" onclick="event.stopPropagation()">
            <div class="p-6">
                <div class="flex justify-between items-start mb-4">
                    <h3 id="modal-title" class="text-xl font-bold text-blue-800">Detalle de Planificación</h3>
                    <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 transition">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>
                <div class="space-y-3 text-gray-700">
                    <p><strong>Entidad:</strong> <span id="modal-region"></span></p>
                    <p><strong>Fecha:</strong> <span id="modal-date"></span></p>
                    <p class="text-sm italic mt-4 border-t pt-3">
                        Unidad de Alerta Temprana (SENAPRED).
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Script de JavaScript para la lógica del calendario -->
    <script>
        // --- 1. CONFIGURACIÓN DE DATOS PARA PLANIFICACIÓN MANUAL ---
        const MONTH_NAMES = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
        
        // Rango de Planificación: Septiembre 2025 (8) a Diciembre 2026 (11)
        const START_MONTH = 8; 
        const END_MONTH = 11; 
        const START_YEAR = 2025;
        const END_YEAR = 2026; 

        // Estructura de datos: [Año] -> [Mes (0=Enero, 11=Diciembre)] -> [Nombre de Región]: [Días Planificados]
        const monthlyPlanningData = {
            // AÑO 2025
            2025: {
                // Septiembre (Mes 8) - DATOS BASE DEL MOCKUP ORIGINAL
                8: {
                    'Arica y Parinacota': [11, 29],
                    'Tarapacá': [11, 29],
                    'Antofagasta': [11, 29],
                    'Atacama': [10, 26],
                    'Coquimbo': [10, 26],
                    'Valparaíso': [10, 26],
                    'Metropolitana': [9, 25],
                    "O'Higgins": [9, 25],
                    'Maule': [9, 25],
                    'Ñuble': [8, 24],
                    'Biobío': [8, 24],
                    'La Araucanía': [8, 24],
                    'Los Ríos': [5, 23],
                    'Los Lagos': [5, 23],
                    'Aysén': [4, 22],
                    'Magallanes': [4, 22],
                    'Isla de Pascua - Rapa Nui': [3, 10, 17, 24],
                    'Juan Fernández': [3, 10, 17, 24],
                    'Director Nacional': [9, 23],
                    'Jefe Depto Alerta T.': [9, 23],
                },
                // Octubre (Mes 9) - DEBE LLENAR MANUALMENTE ESTOS DATOS
                9: { 
                    'Arica y Parinacota': [3, 24], 
                    'Tarapacá': [3, 24],
                    'Antofagasta': [3, 24],
                    'Atacama': [9, 30],
                    'Coquimbo': [9, 30],
                    'Valparaíso': [9, 30],
                    'Metropolitana': [8, 29],
                    "O'Higgins": [8, 29],
                    'Maule': [8, 29],
                    'Ñuble': [7, 28],
                    'Biobío': [7, 28],
                    'La Araucanía': [7, 28],
                    'Los Ríos': [6, 27],
                    'Los Lagos': [6, 27],
                    'Aysén': [13, 20],
                    'Magallanes': [13, 20],
                    'Isla de Pascua - Rapa Nui': [8, 15, 22, 29],
                    'Juan Fernández': [8, 15, 22, 29],
                    'Director Nacional': [7, 21],
                    'Jefe Depto Alerta T.': [7, 21],
                },
                // Noviembre (Mes 10) - DEBE LLENAR MANUALMENTE ESTOS DATOS
                10: { 
                    'Arica y Parinacota': [3, 24], 
                    'Tarapacá': [3, 24],
                    'Antofagasta': [3, 24],
                    'Atacama': [10, 28],
                    'Coquimbo': [10, 28],
                    'Valparaíso': [10, 28],
                    'Metropolitana': [7, 27],
                    "O'Higgins": [7, 27],
                    'Maule': [7, 27],
                    'Ñuble': [6, 26],
                    'Biobío': [6, 26],
                    'La Araucanía': [6, 26],
                    'Los Ríos': [6, 26],
                    'Los Lagos': [6, 26],
                    'Aysén': [13, 20],
                    'Magallanes': [13, 20],
                    'Isla de Pascua - Rapa Nui': [5, 12, 19, 26],
                    'Juan Fernández': [5, 12, 19, 26],
                    'Director Nacional': [4, 18],
                    'Jefe Depto Alerta T.': [4, 18],
                    // ... (Complete el resto de las 22 entidades para Noviembre 2025)
                },
                // Diciembre (Mes 11) - DEBE LLENAR MANUALMENTE ESTOS DATOS
                11: {
                    'Arica y Parinacota': [5, 22], 
                    'Tarapacá': [5, 22],
                    'Antofagasta': [5, 22],
                    'Atacama': [8, 23],
                    'Coquimbo': [8, 23],
                    'Valparaíso': [8, 23],
                    'Metropolitana': [9, 26],
                    "O'Higgins": [9, 26],
                    'Maule': [9, 26],
                    'Ñuble': [10, 29],
                    'Biobío': [10, 29],
                    'La Araucanía': [10, 29],
                    'Los Ríos': [10, 29],
                    'Los Lagos': [10, 29],
                    'Aysén': [15, 30],
                    'Magallanes': [15, 30],
                    'Isla de Pascua - Rapa Nui': [3, 10, 17, 24],
                    'Juan Fernández': [3, 10, 17, 24],
                    'Director Nacional': [9, 16],
                    'Jefe Depto Alerta T.': [9, 16],
                    // ... (Complete el resto de las 22 entidades para Diciembre 2025)
                },
            },
            // AÑO 2026 - DEBE LLENAR MANUALMENTE ESTOS DATOS
            2026: {
                0: {
                    'Arica y Parinacota': [5, 22], 
                    'Tarapacá': [5, 22],
                    'Antofagasta': [5, 22],
                    'Atacama': [8, 23],
                    'Coquimbo': [8, 23],
                    'Valparaíso': [8, 23],
                    'Metropolitana': [9, 26],
                    "O'Higgins": [9, 26],
                    'Maule': [9, 26],
                    'Ñuble': [12, 29],
                    'Biobío': [12, 29],
                    'La Araucanía': [12, 29],
                    'Los Ríos': [12, 29],
                    'Los Lagos': [12, 29],
                    'Aysén': [15, 30],
                    'Magallanes': [15, 30],
                    'Isla de Pascua - Rapa Nui': [6, 13, 20, 27],
                    'Juan Fernández': [6, 13, 20, 27],
                    'Director Nacional': [6, 27],
                    'Jefe Depto Alerta T.': [6, 27],
                }, // Enero
                1: {}, // Febrero
                2: {}, // Marzo
                3: {}, // Abril
                4: {}, // Mayo
                5: {}, // Junio
                6: {}, // Julio
                7: {}, // Agosto
                8: {}, // Septiembre
                9: {}, // Octubre
                10: {}, // Noviembre
                11: {}, // Diciembre
            }
        };

        const regions = [
            // Subtítulo inyectado en la misma celda de la cabecera del grupo
            { name: 'UNIDADES REGIONALES', type: 'header', subtitle: '(Sat./PTT Iridium, Delegado Presidencial/Director Regional, Iridium y BGAN Unidad Regional - Int. Satelital)' },
            { name: 'Arica y Parinacota', type: 'region' },
            { name: 'Tarapacá', type: 'region' },
            { name: 'Antofagasta', type: 'region' },
            { name: 'Atacama', type: 'region' },
            { name: 'Coquimbo', type: 'region' },
            { name: 'Valparaíso', type: 'region' },
            { name: 'Metropolitana', type: 'region' },
            { name: "O'Higgins", type: 'region' },
            { name: 'Maule', type: 'region' },
            { name: 'Ñuble', type: 'region' },
            { name: 'Biobío', type: 'region' },
            { name: 'La Araucanía', type: 'region' },
            { name: 'Los Ríos', type: 'region' },
            { name: 'Los Lagos', type: 'region' },
            { name: 'Aysén', type: 'region' },
            { name: 'Magallanes', type: 'region' },
            
            { name: 'TERRITORIO INSULAR con NIVEL CENTRAL', type: 'header', subtitle: '(Isla de Pascua y Archipiélago Juan Fernández)' },
            { name: 'Isla de Pascua - Rapa Nui', type: 'insular' },
            { name: 'Juan Fernández', type: 'insular' },

            { name: 'AUTORIDADES SENAPRED', type: 'header', subtitle: '(Director(a) Nacional - Jefe Depto. Alerta Temprana)' },
            { name: 'Director Nacional', type: 'authority' },
            { name: 'Jefe Depto Alerta T.', type: 'authority' },
        ];
        
        // --- 2. LÓGICA DEL CALENDARIO Y NAVEGACIÓN ---
        
        let currentDate = new Date();
        let currentYear = START_YEAR;
        let currentMonth = START_MONTH; 

        /**
         * Inicializa la fecha actual para el componente.
         * Si el año actual está dentro del rango (2025/2026), se centra en el mes actual.
         */
        function initializeDate() {
            const todayYear = currentDate.getFullYear();
            const todayMonth = currentDate.getMonth();

            if (todayYear >= START_YEAR && todayYear <= END_YEAR) {
                if (todayYear === START_YEAR && todayMonth < START_MONTH) {
                    currentMonth = START_MONTH;
                    currentYear = START_YEAR;
                } else if (todayYear === END_YEAR && todayMonth > END_MONTH) {
                    currentMonth = END_MONTH;
                    currentYear = END_YEAR;
                } else {
                    currentMonth = todayMonth;
                    currentYear = todayYear;
                }
            } else if (todayYear > END_YEAR) {
                currentMonth = END_MONTH;
                currentYear = END_YEAR;
            } else {
                currentMonth = START_MONTH;
                currentYear = START_YEAR;
            }
        }
        
        /**
         * Obtiene los días planificados directamente del objeto monthlyPlanningData sin recurrencia.
         */
        function getScheduledDays(regionName, month, year) {
            const yearData = monthlyPlanningData[year] || {};
            const monthData = yearData[month] || {};
            
            // Devuelve la lista de días para esa región, o un arreglo vacío si no existe.
            return monthData[regionName] || [];
        }

        /**
         * Obtiene el número de días del mes.
         */
        function getDaysInMonth(year, month) {
            return new Date(year, month + 1, 0).getDate();
        }

        /**
         * Obtiene el día de la semana para el primer día del mes (1=Lunes, 7=Domingo).
         */
        function getFirstDayOfMonth(year, month) {
            let day = new Date(year, month, 1).getDay();
            return day === 0 ? 7 : day;
        }

        /**
         * Muestra el modal con los detalles del evento.
         */
        function showModal(region, day) {
            const dateStr = `${day} de ${MONTH_NAMES[currentMonth]} de ${currentYear}`;
            
            document.getElementById('modal-region').textContent = region;
            document.getElementById('modal-date').textContent = dateStr;
            document.getElementById('event-modal-overlay').style.display = 'flex';
        }

        /**
         * Oculta el modal.
         */
        function closeModal() {
            document.getElementById('event-modal-overlay').style.display = 'none';
        }
        
        /**
         * Renderiza la matriz de planificación.
         */
        function renderPlanningGrid() {
            const daysInMonth = getDaysInMonth(currentYear, currentMonth);
            const firstDay = getFirstDayOfMonth(currentYear, currentMonth); 
            const planningBody = document.getElementById('planning-body');
            planningBody.innerHTML = ''; 

            // 1. Actualizar título de navegación
            document.getElementById('current-month-year').textContent = `${MONTH_NAMES[currentMonth]} ${currentYear}`;

            // 2. Fila de Días de la semana (Lu, Ma, Mi, Ju, Vi, Sá, Do)
            let dayOfWeekRow = `
                <tr class="bg-gray-200 border-b border-gray-300">
                    <th class="py-1 px-2 text-left font-bold text-xs text-gray-700 uppercase sticky-region-col sticky-corner-header border-b border-gray-400">
                        Entidad / Día
                    </th>
            `;
            const dayLabels = ['Lu', 'Ma', 'Mi', 'Ju', 'Vi', 'Sá', 'Do'];
            
            for (let i = 1; i <= daysInMonth; i++) {
                const dayIndex = (firstDay + i - 2) % 7; 
                const correctedDayIndex = dayIndex < 0 ? dayIndex + 7 : dayIndex; 
                const dayLabel = dayLabels[correctedDayIndex];
                const isWeekend = correctedDayIndex >= 5; // 5=Sá, 6=Do

                dayOfWeekRow += `
                    <th class="header-cell border-r border-gray-300 sticky top-0 z-10 
                        ${isWeekend ? 'weekend-bg' : 'weekday-bg'}">
                        ${dayLabel}
                    </th>
                `;
            }
            dayOfWeekRow += '</tr>';
            planningBody.innerHTML += dayOfWeekRow;


            // 3. Fila de Números de Día (1, 2, 3, ...)
            let dayNumberRow = `
                <tr class="bg-gray-100 border-b-2 border-blue-600">
                    <th class="py-1 px-2 text-left font-bold text-xs text-gray-700 sticky-region-col sticky-corner-days border-b-2 border-blue-600">
                        <!-- Celda de esquina vacía -->
                    </th>
            `;
            for (let i = 1; i <= daysInMonth; i++) {
                 const dayIndex = (firstDay + i - 2) % 7; 
                 const correctedDayIndex = dayIndex < 0 ? dayIndex + 7 : dayIndex; 
                 const isWeekend = correctedDayIndex >= 5;

                dayNumberRow += `
                    <th class="header-cell border-r border-gray-300 font-bold sticky top-[30px] z-10 
                        ${isWeekend ? 'bg-red-200 text-gray-900' : 'bg-gray-100 text-gray-900'}">
                        ${i}
                    </th>
                `;
            }
            dayNumberRow += '</tr>';
            planningBody.innerHTML += dayNumberRow;

            // 4. Filas de Datos de Regiones
            regions.forEach((item, index) => {
                const isEvenRow = index % 2 === 0;
                const rowBg = isEvenRow ? 'bg-white' : 'bg-gray-50'; // Zebra-striping
                
                // Obtiene los días planificados para el mes y año actuales.
                const scheduledDays = getScheduledDays(item.name, currentMonth, currentYear);

                if (item.type === 'header') {
                    // Fila de encabezado de grupo (Contiene título y subtítulo)
                    planningBody.innerHTML += `
                        <tr class="group-header-row border-b border-gray-400">
                            <!-- Columna principal del grupo (Título UNIDADES REGIONALES) -->
                            <td class="group-header py-1 px-4 text-gray-800 sticky-region-col bg-gray-300 border-r border-gray-400">
                                ${item.name}
                            </td>
                            <!-- Celda derecha que ocupa todo el espacio de los días y contiene el subtítulo -->
                            <td colspan="${daysInMonth}" class="group-header-subtitle-cell">
                                ${item.subtitle}
                            </td>
                        </tr>
                    `;

                } else {
                    // Fila de datos de la región
                    let regionRow = `
                        <tr class="border-b border-gray-200 hover:bg-blue-100 transition duration-100 ${rowBg}">
                            <td class="py-1 text-xs text-gray-800 sticky-region-col ${rowBg}">
                                ${item.name}
                            </td>
                    `;
                    
                    for (let i = 1; i <= daysInMonth; i++) {
                        const isScheduled = scheduledDays.includes(i);
                        const cellClasses = isScheduled
                            ? 'marked-day'
                            : '';

                        regionRow += `
                            <td class="header-cell border-r border-gray-300 ${cellClasses}"
                                ${isScheduled ? `title="Click para ver detalles de la prueba" onclick="showModal('${item.name}', ${i})"` : ''}
                            >
                                <!-- Celda vacía con solo color -->
                            </td>
                        `;
                    }
                    regionRow += '</tr>';
                    planningBody.innerHTML += regionRow;
                }
            });
            
            // Lógica de deshabilitación de botones:
            
            const currentTotalMonths = (currentYear - START_YEAR) * 12 + currentMonth;
            const startTotalMonths = (START_MONTH);
            const endTotalMonths = (END_YEAR - START_YEAR) * 12 + END_MONTH;
            
            document.querySelector('#month-navigation button:first-child').disabled = currentTotalMonths <= startTotalMonths;
            document.querySelector('#month-navigation button:last-child').disabled = currentTotalMonths >= endTotalMonths;
        }

        /**
         * Cambia el mes/año actual y vuelve a renderizar.
         */
        function changeMonth(delta) {
            let newDate = new Date(currentYear, currentMonth + delta, 1);
            let newYear = newDate.getFullYear();
            let newMonth = newDate.getMonth();
            
            const isWithinRange = 
                (newYear > START_YEAR || (newYear === START_YEAR && newMonth >= START_MONTH)) &&
                (newYear < END_YEAR || (newYear === END_YEAR && newMonth <= END_MONTH));
                
            if (isWithinRange) {
                currentMonth = newMonth;
                currentYear = newYear;
                renderPlanningGrid();
            }
        }

        // Inicializar el calendario al cargar la página
        window.onload = () => {
            initializeDate(); 
            renderPlanningGrid();
        };
        
        // Cierre de modal si se pulsa ESC
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && document.getElementById('event-modal-overlay').style.display === 'flex') {
                closeModal();
            }
        });
    </script>
</body>
</html>
